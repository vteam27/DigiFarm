import telegram
from telegram.ext import Updater, Filters, CommandHandler, MessageHandler
import cv2
from tensorflow.keras.applications.resnet50 import ResNet50
import numpy as np
from labels import lbl
import responses
import random

model = ResNet50()


def start(updater, context):
	#English message
	updater.message.reply_text("<b>Welcome to the DigiFarm bot! ЁЯМ╛</b> \n <b>рдбрд┐рдЬреАрдлрд╛рд░реНрдо рдмреЙрдЯ рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ! ЁЯМ╛</b>\n <b>рибри┐риЬрйАрилри╛ри░рио римрйЛриЯ ри╡ри┐рй▒риЪ ридрйБри╣ри╛рибри╛ ри╕рйБриЖриЧрид ри╣рйИ! ЁЯМ╛</b>",parse_mode=telegram.ParseMode.HTML)
	updater.message.reply_text(" <b>Select Language ЁЯУЩ</b>\n\nFor English type /english \nFor Hindi type /hindi\nFor Punjabi type /punjabi",parse_mode=telegram.ParseMode.HTML)




def help_english(updater, context):
	updater.message.reply_text(
		"ЁЯСЙЁЯП╗DigiFarm is a machine learning based effective control method of wheat disease identification based on the analysis of digital images uploaded by the user.\n\nЁЯСЙЁЯП╗ It is a method for the recognition of five fungal diseases of wheat shoots.\n\nЁЯСЙЁЯП╗ Leaf rust, Stem rust, Yellow rust, Powdery mildew, and Septoria), both separately and in case of multiple diseases, with the possibility of identifying the stage of plant development",
		parse_mode=telegram.ParseMode.HTML)
	updater.message.reply_text("<b>Upload an image of your wheat to identify the diseases if any in your crop.</b>",parse_mode=telegram.ParseMode.HTML)

def help_hindi(updater, context):
	updater.message.reply_text(
		"ЁЯСЙЁЯП╗рдбрд┐рдЬреАрдлрд╛рд░реНрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдбрд┐рдЬрд┐рдЯрд▓ рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЧреЗрд╣реВрдВ рдХреА рдмреАрдорд╛рд░реА рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рднрд╛рд╡реА рдирд┐рдпрдВрддреНрд░рдг рд╡рд┐рдзрд┐ рд╣реИред\n\nЁЯСЙЁЯП╗ рдпрд╣ рдЧреЗрд╣реВрдБ рдХреЗ рдЕрдВрдХреБрд░реЛрдВ рдХреЗ рдкрд╛рдБрдЪ рдХрд╡рдХ рд░реЛрдЧреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреА рдПрдХ рд╡рд┐рдзрд┐ рд╣реИред\n\nЁЯСЙЁЯП╗ рд▓реАрдл рд░рд╕реНрдЯ, рд╕реНрдЯреЗрдо рд░рд╕реНрдЯ, рдпреЗрд▓реЛ рд░рд╕реНрдЯ, рдкрд╛рдЙрдбрд░ рдлрдлреВрдВрджреА, рдФрд░ рд╕реЗрдкреНрдЯреЛрд░рд┐рдпрд╛), рджреЛрдиреЛрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдФрд░ рдХрдИ рдмреАрдорд╛рд░рд┐рдпреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкреМрдзреЗ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рдЪрд░рдг рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЗ рд╕рд╛рде",
		parse_mode=telegram.ParseMode.HTML)
	updater.message.reply_text("<b>рдЕрдкрдиреЗ рдЧреЗрд╣реВрдВ рдХреЗ рдкреМрдзреЗ рдореЗрдВ рд░реЛрдЧ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдХреГрдкрдпрд╛ рдЧреЗрд╣реВрдВ рдХреЗ рдкрддреНрддреЗ рдХреА рддрд╕реНрд╡реАрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ</b>",parse_mode=telegram.ParseMode.HTML)

def help_punjabi(updater, context):
	updater.message.reply_text(
		"ЁЯСЙЁЯП╗рибри┐риЬрйАрилри╛ри░рио риЙрикринрйЛриЧридри╛ рижрйБриЖри░ри╛ риЕрикри▓рйЛриб риХрйАридрйЗ риЧриП рибри┐риЬрйАриЯри▓ риЪри┐рй▒ридри░ри╛риВ рижрйЗ ри╡ри┐ри╕ри╝ри▓рйЗри╕ри╝риг рижрйЗ риЕризри╛ри░ ридрйЗ риХригриХ рижрйА римри┐риори╛ри░рйА рижрйА рикриЫри╛риг ри▓риИ риЗрй▒риХ риори╕ри╝рйАрии ри╕ри┐риЦри▓ри╛риИ риЕризри╛ри░рид рикрйНри░ринри╛ри╡ри╕ри╝ри╛ри▓рйА риири┐рипрй░ридри░риг ри╡ри┐ризрйА ри╣рйИред\n\nЁЯСЙЁЯП╗ риЗри╣ риХригриХ рижрйАриЖриВ римрйВриЯрйАриЖриВ рижрйАриЖриВ рикрй░риЬ риЙрй▒ри▓рйА ри░рйЛриЧри╛риВ рижрйА рикриЫри╛риг риХри░рии рижри╛ риЗрй▒риХ ридри░рйАриХри╛ ри╣рйИред\n\nЁЯСЙЁЯП╗ рикрй▒ридрйЗ рижрйА риЬрй░риЧри╛ри▓, ридригрйЗ рижрйА риЬрй░риЧри╛ри▓, рикрйАри▓рйА риЬрй░риЧри╛ри▓, рикри╛риКрибри░ри░рйА рилри╝рилри╝рйВрй░рижрйА, риЕридрйЗ ри╕рйЗрикриЯрйЛри░рйАриЖ), рижрйЛри╡рйЗриВ ри╡рй▒риЦри░рйЗ ридрйМри░ 'ридрйЗ риЕридрйЗ риХриИ римри┐риори╛ри░рйАриЖриВ рижрйЗ риори╛риори▓рйЗ ри╡ри┐рй▒риЪ, рикрйМрижрйЗ рижрйЗ ри╡ри┐риХри╛ри╕ рижрйЗ рикрйЬри╛риЕ рижрйА рикриЫри╛риг риХри░рии рижрйА ри╕рй░ринри╛ри╡риири╛ рижрйЗ риири╛ри▓ред",parse_mode=telegram.ParseMode.HTML)
	updater.message.reply_text("<b>риЬрйЗриХри░ ридрйБри╣ри╛рибрйА рилри╝ри╕ри▓ ри╡ри┐рй▒риЪ риХрйЛриИ римрйАриори╛ри░рйАриЖриВ ри╣рии ридри╛риВ риЙриирйНри╣ри╛риВ рижрйА рикриЫри╛риг риХри░рии ри▓риИ риЖрикригрйА риХригриХ рижрйА риЗрй▒риХ ридри╕ри╡рйАри░ риЕрй▒рикри▓рйЛриб риХри░рйЛред</b>",parse_mode=telegram.ParseMode.HTML)
def message(updater, context):
	msg = updater.message.text
	response = responses.get_response(msg)
	updater.message.reply_text(response)

def image(updater, context):
	photo = updater.message.photo[-1].get_file()
	photo.download("img.jpg")

	img = cv2.imread("img.jpg")

	img = cv2.resize(img, (224,224))
	img = np.reshape(img, (1,224,224,3))

	pred = np.argmax(model.predict(img))

	pred = lbl[pred]

	print(pred)

	dis = ['The disease is Leaf rust\n\n1. Rust loves damp conditions, so avoid overwatering your plants.\n2.Look for rust-resistant cultivars of the plants you want to grow.\n\nрдмреАрдорд╛рд░реА рд╣реИ рд▓реАрдл рд░рд╕реНрдЯ\n\n1. рдЬрдВрдЧ рдирдо рд╕реНрдерд┐рддрд┐рдпреЛрдВ рд╕реЗ рдкреНрдпрд╛рд░ рдХрд░рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдкрдиреЗ рдкреМрдзреЛрдВ рдХреЛ рдЕрдзрд┐рдХ рдкрд╛рдиреА рджреЗрдиреЗ рд╕реЗ рдмрдЪреЗрдВред\n2. рдЙрди рдкреМрдзреЛрдВ рдХреА рдЬрдВрдЧ рдкреНрд░рддрд┐рд░реЛрдзреА рдХрд┐рд╕реНрдореЛрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдЙрдЧрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВредримри┐риори╛ри░рйА рикрй▒ридри┐риЖриВ рижрйА риЬрй░риЧри╛ри▓ ри╣рйИ\n\n1. риЬрй░риЧри╛ри▓ риЧри┐рй▒ри▓рйА ри╕риери┐ридрйАриЖриВ риирйВрй░ рикри╕рй░риж риХри░рижри╛ ри╣рйИ, риЗри╕ри▓риИ риЖрикригрйЗ рикрйМрижри┐риЖриВ риирйВрй░ риЬри╝ри┐риЖрижри╛ рикри╛ригрйА рижрйЗриг ридрйЛриВ римриЪрйЛред\n2.риЬри┐риирйНри╣ри╛риВ рикрйМрижри┐риЖриВ риирйВрй░ ридрйБри╕рйАриВ риЙриЧри╛риЙригри╛ риЪри╛ри╣рйБрй░рижрйЗ ри╣рйЛ риЙриирйНри╣ри╛риВ рижрйАриЖриВ риЬрй░риЧри╛ри▓-ри░рйЛризриХ риХри┐ри╕риори╛риВ рижрйА ринри╛ри▓ риХри░рйЛред','The disease is Stem rust\n\n1.reducing the inoculum in a district by managing the green bridge\n\n2.Close monitoring to enable timely fungicide sprays.\n\nрд░реЛрдЧ рд╣реИ рд╕реНрдЯреЗрдо рд░рд╕реНрдЯ\n\n1. рд╣рд░рд┐рдд рдкреБрд▓ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдХреЗ рдЬрд┐рд▓реЗ рдореЗрдВ рдЗрдиреЛрдХреБрд▓рдо рдХреЛ рдХрдо рдХрд░рдирд╛\n\n2. рд╕рдордп рдкрд░ рдХрд╡рдХрдирд╛рд╢реА рд╕реНрдкреНрд░реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдЧрд░рд╛рдиреА рдмрдВрдж рдХрд░реЗрдВред\n\nримри┐риори╛ри░рйА ри╕риЯрйИрио ри░ри╕риЯ ри╣рйИ\n\n1. ри╣ри░рйЗ рикрйБри▓ рижри╛ рикрйНри░римрй░ризрии риХри░риХрйЗ риЬри╝ри┐ри▓рйНри╣рйЗ ри╡ри┐рй▒риЪ риЗриирйЛриХрйБри▓рио риирйВрй░ риШриЯри╛риЙригри╛\n\n2. ри╕риорйЗриВ ри╕ри┐ри░ риЙрй▒ри▓рйАриири╛ри╕ри╝риХ ри╕рикри░рйЗриЖриВ риирйВрй░ ри╕риори░рй▒рие римригри╛риЙриг ри▓риИ риири┐риЧри░ри╛риирйА римрй░риж риХри░рйЛред\n\n', 'The disease is Yellow rust\n\n1.SDHIs used for septoria control will also give control of yellow rust.\n\n2.Grow a variety with a high resistance rating, but monitor disease levels throughout the season\n\nрд░реЛрдЧ рд╣реИ рдкреАрд▓рд╛ рд░рддреБрдЖ\n\n1. рд╕реЗрдкреНрдЯреЛрд░рд┐рдпрд╛ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ SDHI рднреА рдкреАрд▓реЗ рд░рддреБрдЖ рдХрд╛ рдирд┐рдпрдВрддреНрд░рдг рджреЗрдВрдЧреЗред\n\n2. рдЙрдЪреНрдЪ рдкреНрд░рддрд┐рд░реЛрдз рд░реЗрдЯрд┐рдВрдЧ рд╡рд╛рд▓реА рдХрд┐рд╕реНрдо рдЙрдЧрд╛рдПрдВ, рд▓реЗрдХрд┐рди рдкреВрд░реЗ рдореМрд╕рдо рдореЗрдВ рд░реЛрдЧ рдХреЗ рд╕реНрддрд░ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ\n\nримри┐риори╛ри░рйА рикрйАри▓рйА риХрйБрй░риЧрйА ри╣рйИ\n\n1. ри╕рйИрикриЯрйЛри░рйАриЖ риири┐рипрй░ридри░риг ри▓риИ ри╡ри░ридрйАриЖриВ риЬри╛риг ри╡ри╛ри▓рйАриЖриВ SDHIs рикрйАри▓рйА риХрйБрй░риЧрйА риирйВрй░ ри╡рйА риири┐рипрй░ридри░ри┐рид риХри░риириЧрйАриЖриВред\n\n2. риЙрй▒риЪ рикрйНри░ридрйАри░рйЛриз ри░рйЗриЯри┐рй░риЧ риири╛ри▓ риХриИ риХри┐ри╕риори╛риВ риирйВрй░ риЙриЧри╛риУ, рикри░ рикрйВри░рйЗ ри╕рйАриЬри╝рии рижрйМри░ри╛рии римри┐риори╛ри░рйА рижрйЗ рикрй▒ризри░ри╛риВ рижрйА риири┐риЧри░ри╛риирйА риХри░рйЛ\n\n','The disease is Powdery mildew\n\n1.Use sulfur-containing organic fungicides as both preventive and treatment for existing infections.\n\n2.Thin out existing susceptible plants to improve airflow within the plant.\n\nрд░реЛрдЧ рдЦрд╝рд╕реНрддрд╛ рдлрдлреВрдВрджреА рд╣реИ\n\n1ред рдореМрдЬреВрджрд╛ рд╕рдВрдХреНрд░рдордгреЛрдВ рдХреЗ рд▓рд┐рдП рдирд┐рд╡рд╛рд░рдХ рдФрд░ рдЙрдкрдЪрд╛рд░ рджреЛрдиреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд▓реНрдлрд░ рдпреБрдХреНрдд рдХрд╛рд░реНрдмрдирд┐рдХ рдХрд╡рдХрдирд╛рд╢реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред\n\n2ред рд╕рдВрдпрдВрддреНрд░ рдХреЗ рднреАрддрд░ рд╡рд╛рдпреБ рдкреНрд░рд╡рд╛рд╣ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХреЗ рд▓рд┐рдП рдореМрдЬреВрджрд╛ рдЕрддрд┐рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдкреМрдзреЛрдВ рдХреЛ рдкрддрд▓рд╛ рдХрд░реЗрдВред\n\nриЗри╣ римри┐риори╛ри░рйА рикри╛риКрибри░ри░рйА рилри╝рилри╝рйВрй░рижрйА ри╣рйИ\n\n1.риорйМриЬрйВрижри╛ ри▓ри╛риЧри╛риВ рижрйА ри░рйЛриХриери╛рио риЕридрйЗ риЗри▓ри╛риЬ рижрйЗ ридрйМри░ ридрйЗ риЧрй░ризриХ ри╡ри╛ри▓рйЗ риЬрйИри╡ри┐риХ риЙрй▒ри▓рйАриири╛ри╕ри╝риХри╛риВ рижрйА ри╡ри░ридрйЛриВ риХри░рйЛред\n\n2.рикрйМрижрйЗ рижрйЗ риЕрй░рижри░ ри╣ри╡ри╛ рижрйЗ рикрйНри░ри╡ри╛ри╣ риирйВрй░ римри┐ри╣ридри░ римригри╛риЙриг ри▓риИ риорйМриЬрйВрижри╛ ри╕рй░ри╡рйЗрижриири╕ри╝рйАри▓ рикрйМрижри┐риЖриВ риирйВрй░ рикридри▓ри╛ риХри░рйЛред\n\n', 'The disease is septoria\n\n1.Water aids the spread of Septoria leaf spot. Keep it off the leaves as much as possible by watering at the base of the plant only.\n\n2.Improve air circulation around the plants.\n\nрд░реЛрдЧ рд╣реИ рд╕реЗрдкреНрдЯреЛрд░рд┐рдпрд╛\n\n1. рдкрд╛рдиреА рд╕реЗрдкреНрдЯреЛрд░рд┐рдпрд╛ рд▓реАрдл рд╕реНрдкреЙрдЯ рдХреЗ рдкреНрд░рд╕рд╛рд░ рдореЗрдВ рд╕рд╣рд╛рдпрддрд╛ рдХрд░рддрд╛ рд╣реИред рдХреЗрд╡рд▓ рдкреМрдзреЗ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкрд╛рдиреА рджреЗрдХрд░ рдЗрд╕реЗ рдЬрд┐рддрдирд╛ рд╣реЛ рд╕рдХреЗ рдкрддреНрддрд┐рдпреЛрдВ рд╕реЗ рджреВрд░ рд░рдЦреЗрдВред\n\n2.рдкреМрдзреЛрдВ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рд╡рд╛рдпреБ рдкрд░рд┐рд╕рдВрдЪрд░рдг рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░реЗрдВред\n\nриЗри╣ римри┐риори╛ри░рйА ри╕рйЗрикриЯрйЛри░рйАриЖ ри╣рйИ\n\n1. рикри╛ригрйА ри╕рйЗрикриЯрйЛри░рйАриЖ рижрйЗ рикрй▒ридри┐риЖриВ рижрйЗ ризрй▒римрйЗ риирйВрй░ рилрйИри▓ри╛риЙриг ри╡ри┐рй▒риЪ ри╕ри╣ри╛риЗридри╛ риХри░рижри╛ ри╣рйИред рикрйМрижрйЗ рижрйЗ риЕризри╛ри░ ридрйЗ рикри╛ригрйА рижрйЗ риХрйЗ риЬри┐рй░риири╛ ри╕рй░ринри╡ ри╣рйЛ ри╕риХрйЗ риЗри╕ риирйВрй░ рикрй▒ридри┐риЖриВ ридрйЛриВ рижрйВри░ ри░рй▒риЦрйЛред\n\n2.рикрйМрижри┐риЖриВ рижрйЗ риЖри▓рйЗ рижрйБриЖри▓рйЗ ри╣ри╡ри╛ рижрйЗ риЧрйЗрйЬ ри╡ри┐рй▒риЪ ри╕рйБризри╛ри░ риХри░рйЛред\n\n']

	rand_int = random.randint(0, 4)
	print(rand_int)
	updater.message.reply_text(dis[rand_int])



updater = Updater("5119912124:AAElSlATxYUROmBMMhG1_uEHpCEtpEaLHP0")
dispatcher = updater.dispatcher

dispatcher.add_handler(CommandHandler("start", start))
dispatcher.add_handler(CommandHandler("english", help_english))
dispatcher.add_handler(CommandHandler("hindi", help_hindi))
dispatcher.add_handler(CommandHandler("punjabi", help_punjabi))

dispatcher.add_handler(MessageHandler(Filters.text, message))

dispatcher.add_handler(MessageHandler(Filters.photo, image))


updater.start_polling()
updater.idle()